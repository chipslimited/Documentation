# CPS 技术白皮书

__2018年1月23日__

版权所有 © 2018 Chips Limited

注：任何个人可不经授权将本白皮书用于非商业行为，只需要引述上述版权声明即可。

__简介：__ 本软件系统引入了一个新型的区块链体系架构以实现分布式应用程序。该架构通过构建一个分布式的操作系统而实现。本软件系统提供了账户、认证、异步通信与服务器集群的调度功能。最终，系统实现了一个可实现高并发、支持快速部署、减少用户使用成本的区块链体系架构。

__免责声明：__ 本白皮书只供信息传递目的，不作为商业用户，亦不构成投资建议。


# 导语
在架构选定的情况下，我们大量学习了EOS.IO的构建方式，并在白皮书中对其技术特性进行了深入挖掘，在CHIPS创始团队成员一致认为EOS.IO的技术特性高度符合《CPS经济白皮书》商业模型选定的情况下，后期我们将保持与EOS.IO版本同步更新的策略。

以下将重点从技术角度对EOS.IO进行深入挖掘，并在《CPS经济白皮书》中对挖掘到的技术逻辑点进行一一对应的商业延伸介绍，并且在CPS Coin主干网络中埋下代码伏笔，用以高度配合CHIPS数字王国2.0版本的建立。

# 名词定义

## 操作系统：
一组可以支持计算机基本功能的软件，这些功能包括：任务调度、执行应用、控制周边设备、通讯

## 加密货币：
一类使用计算机密码学原理来确保交易安全的交易媒介的统称。广义的加密货币不局限于传统意义上“货币”应用，还包括通讯、确权、智能合约等功能和应用场景。

## 智能合约：
所谓的智能合约就是一段能够根据预先编好的代码执行一种用户间的条款，它有计算机自动执行，因而具备强制力。CPS Coin允许任何用户根据软件的标准及协议运行智能合约。

## IPFS
IPFS是一套新兴的存储和可根据内容寻址文件的标准。可根据内容寻址的意思是根据文件的内容而不是网址来查找文件，或者换句话说，我们可以根据一个文件的哈希值来查找文件。因为有哈希的机制，同样内容 的文件就会具备相同的“文件名”，并且该文件的内容不能更改。因为只要更改了文件的内容，文件名也会随之更改，也就是说这将是另一份文件了。当然，我们可以通过文件名来校验文件内容，确保文件内容不被非人为或人为的因素所篡改。

IPFS又包含了一套P2P（BT下载就是一种P2P）的文件共享机制。需要我们注意的是，任何P2P文件下载机制无法保证文件的持久存储、可访问性、或下载的带宽。如果整个网络连文件的最后一幅副本也没了，那么文件就相当于从网络上消失了，这就意味着持久存储是不被打包票的。因此，我们希望能建立一套有效的激励机制，鼓励用户向区块链网络贡献自己的服务器以及带宽。

一言蔽之，这就有点像某些常用的第三方加速软件存储文件的文件的方式一样。

# 技术背景
第一代区块链技术比特币（BTC）实现了可信的分布式账本，第二代区块链技术以太坊实现了基于可信账本的计算。后者即智能合约。在智能合约的世界里，资产的权益及历史记录将被公开、可信、有效地记载，同时智能合约的“全节点”和“矿机”将使得智能合约强制有效地执行。这种铁面无私的执行力使得用户对区块链系统有着更高的期待，包括其功能、可靠性、效率等。更具体地说，我们在比特币及以太坊的实例中发现如下瓶颈：
1. 功能限制：两者只适合构建围绕“交易”（transaction）为主的功能，如记账、投票、签名等系统。对于其他类型的应用捉襟见肘。
2. 计算能力限制：智能合约的执行所支持指令集有限。
3. 存储能力限制：区块链上存储无法存储更多的信息（否则将面临更高的交易手续。且数据的存储速度较慢，一个参考数字是7秒/KB.
4. 无法高并发（scale）：受限于EVM 运行机制，智能合约必须同步在各个节点中运行。近期一些DAPP使得网络堵塞即证明，单个主链无法支撑个别应用，更不要提今后将面临更多应用。这是因为，现有主流区块链的运行机制使“分布式”带来的收益大为受限，无论区块链运行时有多少个分布式的节点，其性能本质上相当于单一节点
5. 高手续费：比特币及以太坊在发明时的单价较低，因而初始设计没有预见到手续费大涨问题。比特币的手续费没有考虑到小额支付，以太坊的问题类似，只是程度轻一些。
6. 粉尘攻击：垃圾数据、无效数据会给区块链的运转效率带来很多负面影响。比特币的转账确认时间长，以太坊的拥堵都可证明这一点
7. 紧密耦合：区块链骨干网络与虚拟机紧密耦合，无法体现软件工程设计角度的“分层”。

综上所述，以比特币为代表的第一代区块链与以太坊为代表的第二代区块链在用户日益增高的需求面前捉襟见肘。区块链世界呼唤更优的解决方案。

# 技术开发目标
本平台致力于打造一套如下的系统：
1. 支持亿级的用户数: 像BAT，或者是Google, Amazon这样的巨无霸级的系统，需要为上亿的用户提供稳健的系统支撑。考虑到麦特卡夫定律，本系统的价值与用户数的平方成正比，因此，随着时间的发展，系统必将具备很强的延续性。
1. 并行计算：无论是单机的多线程、多核CPU，还是基于网络的高并发，系统需要提供一种分派任务的机制
1. 低延迟：低延迟是良好用户体验的最关键因素。
1. 良好的升级与错误修复：“凡是代码，必有bug”。因而，系统的升级也是很必要的一环。在涉及价值及交易的环节，需要及时修复bug以确保安全。同时，系统支持快速迭代与演进，以建设成为有机的自进化的生态。
1. 抗攻击：对于无效或非法的数据及消息，系统将更早地将其过滤掉，以提供更洁净的环境。

# 特性

## 分布式存储

Cps Coin存储是一个探讨性的分散式文件系统，使用用户可以存储和托管能被主流浏览器所访问的文件。 我们知道，有一些其他的替代方案会收取一次性的初始费用，或者是根据存储文件的时间或带宽来收费。但是在本方案不会采取这种模式。本方案会收取一个可全额退还的押金。 用户在需要存储和带宽时需要持有令牌，当然，也能在不需要存储和带宽时转售令牌。区块的生产者服务器（类似于“挖矿”）将会为令牌的持有用户服务，这样，就形成了一套激励机制，确保闭环形成。

因为区块链的安全性和健壮性严重依赖于高度的冗余度，因而，它不适合存储大型的尤其是可能会被修改的文件。比如假定一条交易事务是50个字节，那么一个一秒中能生成十万条交易事务的区块链网络，对于每一个全节点就会带来每秒中增加5MB的负担，一分钟便可增加300MB。为了减少对存储空间的过分依赖，这些交易事务要么在硬盘上被压缩，要么每隔一段时间取一个当前快照，然后丢弃快照之前所有的历史记录。即便如此，区块链上的每个节点都被要求存储相同的内容，将会是资源的极大浪费。

为了解决这个问题，一些区块链的解决方案采取了用IPFS存储文件名，并将智能合约的交易事务打包起来存储在IPFS上，这样的好处就是减少了数据的冗余度，从而减少了对存储的需求。但是这个问题同样没有保证文件一直是可被访问的。因为IPFS本身并不保证文件是必须存在可访问的。前面提到，如果网络上最后一份文件的副本不存在的话，就意味这个文件在整个IPFS上消失了。大家尚且可以接受在BT上找不到想要的音视频资源；但是在涉及到信任和价值交换的区块链上，这种文件的丢失会造成很严重的事故，甚至导致全网的瘫痪。

## 基于DPOS(授权的股权证明)的增量机制
为了能达到更高的性能及效率，本系统采用类似于EOS的DPOS算法。这是一种连续投票机制，在这种机制下，令牌的拥有者可以根据区块的生成情况选择区块的生成服务器。令牌的拥有者可以自主地选择，他们的投票将影响他们所收到的新增令牌的数目。而服务器之间会按照他们所收到的投票的数目进行等比例地分配新区块的共识增量令牌。


## 延识消息传递
对于网络上的消息，我们收到时总会有些担心，消息有可能是无效的，也有可能在当前的交易的时间限制内无法执行完。另外，有时候我们会需要在一个消息中加入当前交易范围以外的信息。在上述情况下应用可以请求区块的产生方在下一个区块或者更以后发出消息（类似于异步机制），这样如果消息是正确有效的，那么你的应用程序会收到通知；反之，那么消息则不会被发出，且消息在超时后会被你的应用清空。


