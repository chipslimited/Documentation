# CPS 技术白皮书

__2018年1月23日__

版权所有 © 2018 Chips Limited

注：任何个人可不经授权将本白皮书用于非商业行为，只需要引述上述版权声明即可。

__简介：__ 本软件系统引入了一个新型的区块链体系架构以实现分布式应用程序。该架构通过构建一个分布式的操作系统而实现。本软件系统提供了账户、认证、异步通信与服务器集群的调度功能。最终，系统实现了一个可实现高并发、支持快速部署、减少用户使用成本的区块链体系架构。

# 免责声明
本白皮书只供信息传递目的，不作为商业用途，亦不构成投资建议。
1. 虽然团队尽最大主观努力使本白皮书的内容尽可能准确地体现系统的设计及实现，但由于项目的技术代码在不断演进迭代中，因此，本白皮书并不保证与发布的代码或提供的服务完全一致。团队也不保证白皮书实时地反映代码的改变。
2. 作为免费开源项目，团队不对发布的代码及提供的服务的准确性提供保证。 __本项目只按照“原样”进行发布。__ 团队默认本白皮书、本代码库的使用者具备充分的法律知识、技术知识及开发能力以保障代码的正确、安全的运行。 __团队不对使用本项目代码所造成损失承担任何责任。__ 这些损失包括但不限于
    * 由无法实现一个预期目标、无法适用、或者无法达到一个头衔所造成的直接间接的损失
    * 由本白皮书与本代码库的代码或者逻辑不一致所造成的直接间接的损失
    * 由本代码库或本代码库相关的服务的错误或bug所造成的直接间接的损失
    * 由本白皮书、本代码库、以及与本代码库相关的服务对第三方构成侵权所造成的直接间接的损失
3. __本白皮书、本代码库、以及与本代码库相关的服务，不构成任何投资建议。 任何个人或团队，未经授权，不得擅自使用本团队、本团队成员、本白皮书撰写者及贡献者、本白皮书、本代码库的名义，进行任何形式的市场推广。任何个人或团队，未经授权，不得通过发布本团队、本团队成员、本白皮书撰写者及贡献者与第三方团队的不实信息。__



# 导语
我们阅读了海量的区块链项目白皮书，在架构选定的情况下，我们大量学习了EOS.IO的构建方式，并在白皮书中对其技术特性进行了深入挖掘，在CHIPS创始团队成员一致认为EOS.IO的技术特性高度符合《CPS商业白皮书》商业模型选定的情况下，后期我们将保持与EOS.IO版本同步更新的策略。

以下将重点从技术角度对EOS.IO进行深入挖掘，并在《CPS商业白皮书》中对挖掘到的技术逻辑点进行一一对应的商业延伸介绍，并且在CPS Coin主干网络中埋下代码伏笔，用以高度配合CHIPS数字王国2.0版本的建立。

# 名词定义

## 操作系统：
一组可以支持计算机基本功能的软件，这些功能包括：任务调度、执行应用、控制周边设备、通讯

## 区块链：
区块链是以分布式方式（即，没有中央数据库）实现，并且通常没有中央权威机构的不可改变（一旦发布，任何交易都不能改变。）的数字账本系统。 在最基础的层面上，他们使一个用户社区能够在公共账本中记录交易。

## 加密货币：
一类使用计算机密码学原理来确保交易安全的交易媒介的统称。广义的加密货币不局限于传统意义上“货币”应用，还包括通讯、确权、智能合约等功能和应用场景。

## 智能合约：
所谓的智能合约就是一段能够根据预先编好的代码执行一种用户间的条款，它由计算机自动执行，因而具备强制力。CPS Coin允许任何用户根据软件的标准及协议运行智能合约。

## IPFS
IPFS是一套新兴的存储和可根据内容寻址文件的标准。可根据内容寻址的意思是根据文件的内容而不是网址来查找文件，或者换句话说，我们可以根据一个文件的哈希值来查找文件。因为有哈希的机制，同样内容 的文件就会具备相同的“文件名”，并且该文件的内容不能更改。因为只要更改了文件的内容，文件名也会随之更改，也就是说这将是另一份文件了。当然，我们可以通过文件名来校验文件内容，确保文件内容不被非人为或人为的因素所篡改。

IPFS又包含了一套P2P（BT下载就是一种P2P）的文件共享机制。需要我们注意的是，任何P2P文件下载机制无法保证文件的持久存储、可访问性、或下载的带宽。如果整个网络连文件的最后一幅副本也没了，那么文件就相当于从网络上消失了，这就意味着持久存储是不被打包票的。因此，我们希望能建立一套有效的激励机制，鼓励用户向区块链网络贡献自己的服务器以及带宽。

一言蔽之，这就有点像某些常用的第三方加速软件存储文件的文件的方式一样。

# 技术背景
第一代区块链技术比特币（BTC）实现了可信的分布式账本，第二代区块链技术以太坊实现了基于可信账本的计算。后者即智能合约。在智能合约的世界里，资产的权益及历史记录将被公开、可信、有效地记载，同时智能合约的“全节点”和“矿机”将使得智能合约强制有效地执行。这种铁面无私的执行力使得用户对区块链系统有着更高的期待，包括其功能、可靠性、效率等。更具体地说，我们在比特币及以太坊的实例中发现如下瓶颈：
1. 功能限制：两者只适合构建围绕“交易”（transaction）为主的功能，如记账、投票、签名等系统。对于其他类型的应用捉襟见肘。
2. 计算能力限制：智能合约的执行所支持指令集有限。
3. 存储能力限制：区块链上存储无法存储更多的信息（否则将面临更高的交易手续。且数据的存储速度较慢，一个参考数值是7秒/KB。
4. 无法高并发（scale）：受限于EVM 运行机制，智能合约必须同步在各个节点中运行。近期一些DAPP使得网络堵塞即证明，单个主链无法支撑个别应用，更不要提今后将面临更多应用。这是因为，现有主流区块链的运行机制使“分布式”带来的收益大为受限，无论区块链运行时有多少个分布式的节点，其性能本质上相当于单一节点
5. 高手续费：比特币及以太坊在发明时的单价较低，因而初始设计没有预见到手续费大涨问题。比特币的手续费没有考虑到小额支付，以太坊的问题类似，只是程度轻一些。
6. 粉尘攻击：垃圾数据、无效数据会给区块链的运转效率带来很多负面影响。比特币的转账确认时间长，以太坊的拥堵都可证明这一点
7. 紧密耦合：区块链骨干网络与虚拟机紧密耦合，无法体现软件工程设计角度的“分层”。

综上所述，以比特币为代表的第一代区块链与以太坊为代表的第二代区块链在用户日益增高的需求面前捉襟见肘。区块链世界呼唤更优的解决方案。

# 技术开发目标
本平台致力于打造一套如下的系统：
1. 支持亿级的用户数: 像BAT，或者是Google, Amazon这样的巨无霸级的系统，需要为上亿的用户提供稳健的系统支撑。考虑到麦特卡夫定律，本系统的价值与用户数的平方成正比，因此，随着时间的发展，系统必将具备很强的延续性。
1. 并行计算：无论是单机的多线程、多核CPU，还是基于网络的高并发，系统需要提供一种分派任务的机制
1. 低延迟：低延迟是良好用户体验的最关键因素。
1. 良好的升级与错误修复：“凡是代码，必有bug”。因而，系统的升级也是很必要的一环。在涉及价值及交易的环节，需要及时修复bug以确保安全。同时，系统支持快速迭代与演进，以建设成为有机的自进化的生态。
1. 抗攻击：对于无效或非法的数据及消息，系统将更早地将其过滤掉，以提供更洁净的环境。

# 特性

## 分布式存储

CPS Coin存储是一个探讨性的分散式文件系统，使用用户可以存储和托管能被主流浏览器所访问的文件。 我们知道，有一些其他的替代方案会收取一次性的初始费用，或者是根据存储文件的时间或带宽来收费。但是在本方案不会采取这种模式。本方案会收取一个可全额退还的押金。 用户在需要存储和带宽时需要持有令牌，当然，也能在不需要存储和带宽时转售令牌。区块的生产者服务器（类似于“挖矿”）将会为令牌的持有用户服务，这样，就形成了一套激励机制，确保闭环形成。

因为区块链的安全性和健壮性严重依赖于高度的冗余度，因而，它不适合存储大型的尤其是可能会被修改的文件。比如假定一条交易事务是50个字节，那么一个一秒中能生成十万条交易事务的区块链网络，对于每一个全节点就会带来每秒中增加5MB的负担，一分钟便可增加300MB。为了减少对存储空间的过分依赖，这些交易事务要么在硬盘上被压缩，要么每隔一段时间取一个当前快照，然后丢弃快照之前所有的历史记录。即便如此，区块链上的每个节点都被要求存储相同的内容，将会是资源的极大浪费。

为了解决这个问题，一些区块链的解决方案采取了用IPFS存储文件名，并将智能合约的交易事务打包起来存储在IPFS上，这样的好处就是减少了数据的冗余度，从而减少了对存储的需求。但是这个问题同样没有保证文件一直是可被访问的。因为IPFS本身并不保证文件是必须存在可访问的。前面提到，如果网络上最后一份文件的副本不存在的话，就意味这个文件在整个IPFS上消失了。大家尚且可以接受在BT上找不到想要的音视频资源；但是在涉及到信任和价值交换的区块链上，这种文件的丢失会造成很严重的事故，甚至导致全网的瘫痪。

## 存储上的隐私
本系统的存储是托管公共数据的平台。需要隐私的用户可以在上传文件之前将文件应用于加密算法。虽然加密文件的内容将是私密的，但上传文件的区块链账户的身份标识仍然是公开的。

## 与对标产品的比较
我们已经有Google Drive, iCloud, Dropbox, 百度网盘很很酷的产品。这些对标产品为用户提供上G的免费存储空间。付费用户可以得到更多的存储空间。但这些产品没有一个像IPFS一样的通用的文件命名系统，它们也不会集成一个开放P2P网络，而且从控制权上是完全中心化的。这样，用户就会面临至少双重的风险：1.服务不可用；2.价格模式改变。在本系统中，由于采用了一个开放的IPFS系统，用户将面对更可靠的网络和计费模型。

## 存储上限


## 基于DPOS(授权的股权证明)的增量机制
为了能达到更高的性能及效率，本系统采用类似于EOS的DPOS算法。这是一种连续投票机制，在这种机制下，令牌的拥有者可以根据区块的生成情况选择区块的生成服务器。令牌的拥有者可以自主地选择，他们的投票将影响他们所收到的新增令牌的数目。而服务器之间会按照他们所收到的投票的数目进行等比例地分配新区块的共识增量令牌。


## 延识消息传递
对于网络上的消息，我们收到时总会有些担心，消息有可能是无效的，也有可能在当前的交易的时间限制内无法执行完。另外，有时候我们会需要在一个消息中加入当前交易范围以外的信息。在上述情况下应用可以请求区块的产生方在下一个区块或者更以后发出消息（类似于异步机制），这样如果消息是正确有效的，那么你的应用程序会收到通知；反之，那么消息则不会被发出，且消息在超时后会被你的应用清空。

## 账户体系
本系统具备完善的账户体系，账户的创建者可选择一定长度范围内、人类可阅读的字符串作为名称，这与比特币，以太坊只有私钥和地址概念的账户系统相比，大大提高了可读性和大规模商用机会。账户的注册只需要很低的费用，就可以覆盖存储账户信息的成本。同时，帐户名称支持命名空间，因此“域名”的所有者是唯一可以创建“帐户名@域名”的用户。


## 基于角色的权限管理
判断一条消息是否被授权，最简单的形式是包含一个签名，这需要知道签名是谁的，一般来说权限是与个体或群组绑定在一起的。多账户的控制机制，能对账户的安全提供保障，减少被黑而造成资金损失的风险。


## 消息处理机制
本系统结合了自动消息处理程序和自描述的数据库体系。每个账户拥有自己的数据库，可以给其他账户发送结构化消息、可以定义消息被接收后的处理程序，且只能自己的消息处理程序访问，该消息处理程序还可以向其他账户发送消息。


## 网络的可扩展性
对于一个商业可行性的平台，可扩展性是至关重要的。以以太坊为代表的2.0版区块链体系的一个关键限制在于：无论整个网络有多少个节点，其性能上限不会超过单线程CPU性能。通过优化，最多每秒100笔。然而，在真实的应用程序负载下，以太坊网络当前的交易可能会被限制到每秒10笔或者更低。长此以往，网络已经被洪水般的交易信息过载，以至于除了能支付最高手续费的交易之外所有交易都被拒绝了。比如最近，由于养猫这款APP的流行，以太坊遭遇到了大面积的崩溃。好在，以太坊的开发者已经制定了一个致力于提升网络扩展性的路线图，该路线图严重依赖数据库的分片。本团队认为：分片是一个技术上具有挑战性的概念，无疑会增加网络的复杂性和攻击范围，并可能降低网络的安全性。因此在这一场景下，分片并不可取。

在可扩展性方面，本系统有两个显著优势：首先，我们会借鉴已经在压力测试中被证明的EOS的石墨烯技术，该技术具备每秒1万至10万笔交易处理能力。其次本系统将使用并行化来扩展网络，或将达到每秒数百万次的交易处理能力，这种能力将支撑数千个商业规模的DAPP。本系统还将使用异步通讯并将认证与执行过程分离来实现加速。

## 抗DOS攻击
由于本系统给予用户按比例的网络带宽、存储空间、和运算能力。因此恶意攻击者只能消耗根据其代币占比拥有的相应比例的网络资源。DOS攻击或许可能在某个特定的应用程序中可用，这取决于应用的设计，但是这些攻击永远不会扰乱中断整个网络。即使许多恶意代理人试图给几个大型的网络应用制造垃圾阻塞，也能保证网络上小规模初创投资项目的带宽可靠性和计算能力。


## 基于所有权模式的网络经济学
本系统和以太坊网络不同的经济模式。本质上，这是所有权模式和租赁模式的对比。对以太坊来说，交易中每次的计算、存储操作、带宽使用都需要GAS费用。而且这些必需的费用是波动的，能够设置成非常高的价格，因为矿工总是优先选择处理高手续费的交易。这在最近的Status ICO中显现的尤为明显，这其中100美元的GAS费用仍然显得太小，哪怕是微不足道的交易。此外，如前一节所述，这种经济模式创造出一种情景，富有的玩家们可能会用高手续费交易淹没网络并导致整个网络的冻结阻塞。并且这种经济模式要求开发者们和初创公司们在应用的开发和部署过程中不停的燃烧GAS费用。相比之下，EOS会采用所有权模式，这种模式下持有EOS代币会给予用户分享相应比例的网络带宽，存储和处理能力。这意味着如果用户拥有1%的EOS代币，无论网络其余部分的负载如何，他将始终可以访问1%的网络带宽。这样小型初创企业和开发者们可以购买相对较小的网络份额以获得稳定可靠的、可以预期的网络带宽和运算能力。需要扩展他们的应用程序的时候只要简单的购买更多的EOS代币即可。此外，由于网络是零交易费用，除了首次购买CPS Coin之外，没有其他的网络开发成本。当然如果愿意，也可以出售这些代币以便收回初始的投资。


## 密钥恢复
账户所有者可以使用30天内的任意属主权限（即最高权限）的密钥，注意这个密钥可能已经被黑客换过了，但是在这个场景下这个密钥还是可以使用的。使用任意30天内的属主密钥和指定的合作伙伴才能恢复密钥。这里面合作伙伴不能在没有属主协助的基础上恢复密钥。合作伙伴也不会参与任何日常交易，这样可以大大降低法律上的风险。


## 共识机制和治理
基于DPOS(授权的股权证明)的增量机制，对商业可扩展性具有显著价值。目前实行POW的以太坊网络背后呈现一个问题是难以处理那些破坏性的应用程序。比如，之前DAO遭遇了致命的bug、黑客攻击和事故。需要特别说明的是，那些拥有“代码即法律”思想的人认为对DAO的黑客攻击也是一种“特性”，而不是一个故障。因而用户应当更加负责任、更加细心的审视代码。不管怎样，这次DAO事故都表明，以太坊上破坏性的应用程序要么导致投资者面临潜在的实质性损失，要么面临导致混乱的硬分叉。根据当前以太坊的POW共识机制，每次的硬分叉也能引起产生多个竞争链的风险，如同以太坊经典ETC在DAO事故之后分裂出来。但为了处理一个破坏性的应用，一个扰乱了整个以太坊网络分裂性的硬分叉又是必须的。相比之下，EOS包含一个冻结和处理破坏性或冻结类应用程序的机制。举例来说，假如DAO在EOS上发生了，它可以被冻结、处理或更新而不会干扰其他应用程序。此外，EOS的DPOS共识机制使得在硬分叉时没有伴生出多重竞争链的潜在可能性。Steem网络经历的18次成功的硬分叉已经证明了这一点，它同样也是运行在石墨烯上。此外，EOS将包含一个有法律约束力的宪法，确立共同管辖权用于解决用户争端，它还包括一个基于股权权重投票产生的自治的社区。



## 不良数据和仲裁

本系统将结合智能合约与法律约束力的仲裁方式，所以这些智能合约可以强加主观要求到各个参与方。根据网络提供的仲裁争议解决机制，任何人都可以发起判定任意存储文件是非法的裁定，并且该文件将被删除如果对应的存储和托管违反法律或其他合同。

CPS Coin存储协议将允许块生产者删除任何法律或仲裁要求删除的文件。不是所有的块生产者都要遵守相同的法律法规;因此，由令牌持有者的社区决定区块生产者是否在正确合理地删除文件。有不正当行为的生产者可以在区块链宪法的仲裁之前被投票否决。

重要的是使用IPFS网络从根本上限制了本系统存储器检查数据的能力。如果其他人将文件托管IPFS网络，即使当块生产者不再存储或提供一个特定的文件，该文件可能仍然可用。标识符仍然是文件的准确描述符，任何独立的完整节点也可以使用独立的IPFS节点访问文件。个人可以选择自己托管它或付款给他人来代替他们托管文件。在这种情况下，个人或他们的服务提供商将承担托管和提供文件的责任。






